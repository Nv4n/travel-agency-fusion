// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

generator zod {
    provider                  = "zod-prisma-types"
    output                    = "../src/zod" // (default) the directory where generated zod schemas will be saved
    createRelationValuesTypes = true
}

datasource db {
    provider     = "postgresql"
    url          = env("VITE_DATABASE_URL")
    directUrl    = env("VITE_DIRECT_URL")
    relationMode = "prisma"
}

//* User models
model User {
    id       String    @id @default(cuid())
    email    String    @unique
    password Password?
    roles    Role[]    @default([USER])

    fname String
    lname String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    reservations Reservation[]
    properties   Property[]
    messages     Message[]
    reviews      Review[]
    Chat         Chat[]

    @@index([id])
}

model Password {
    hash String

    userId String @unique
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum Role {
    USER
    SUPPORT
}

//* ChatTicket models
model Chat {
    id           String    @id @default(cuid())
    messages     Message[]
    participants User[]
}

model Message {
    id      String @id @default(cuid())
    content String

    chatId String
    chat   Chat   @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    User   User   @relation(fields: [userId], references: [id])
    userId String

    @@index([chatId])
    @@index([userId])
}

model Review {
    id      String @id @default(uuid())
    rating  Int    @default(5) @db.SmallInt
    content String //@db.VarChar(255)

    createdAt DateTime @default(now())

    property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    propertyId String
    user       User     @relation(fields: [userId], references: [id], onDelete: Restrict, onUpdate: Restrict)
    userId     String

    @@index([propertyId])
    @@index([userId])
}

//* Property/Hotel models
model Reservation {
    id    String   @id @default(cuid())
    price Float
    from  DateTime
    to    DateTime

    room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    roomId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    userId String

    @@index([roomId])
    @@index([userId])
}

model Property {
    id          String @id @default(cuid())
    description String

    owner   User     @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    ownerId String
    rooms   Room[]
    reviews Review[]

    @@index([ownerId])
}

model Room {
    id        String @id @unique @default(cuid())
    quantity  Int
    maxGuests Int    @map("max_guests")
    price     Float

    hotel        Property      @relation(fields: [hotelId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    hotelId      String
    reservations Reservation[]
    facilities   Facility[]

    @@index([hotelId])
}

model Facility {
    id          String   @id @default(cuid())
    description String
    category    Category
    icon        Icon
    rooms       Room[]
}

enum Category {
    ROOM
    FOOD
    WELLNESS
    MISCELLANEOUS
}

enum Icon {
    BED
    WIFI
    FITNESS
    RESTAURANT
    NOSMOKE
    SOUNDPROOF
    BAR
    AC
    PARKING
    SPA
    BREAKFAST
    FRIDGE
    KITCHEN
}
